worker_processes  auto;

# Enables the use of JIT for regular expressions to speed-up their processing.
pcre_jit on;


events {
  worker_connections  1024;
}

http {

  # Don't tell nginx version to clients.
  server_tokens off;


  server {
    listen 8080;
    server_name  '';
    add_header Access-Control-Allow-Origin '';
    add_header Access-Control-Allow-Credentials 'true';
    # add_header Access-Control-Allow-Headers 'Content-Type,accept,x-wsse,origin';
    # add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS, PUT, DELETE';

    root   /usr/share/nginx/html;
    index  index.html index.htm;
    include /etc/nginx/mime.types;

    gzip on;
    # Set the Vary HTTP header as defined in the RFC 2616.
    gzip_vary on;
    # Enable checking the existence of precompressed files.
    gzip_static on;


    gzip_min_length 1000;
    gzip_proxied expired no-cache no-store private auth;
    gzip_types text/plain text/css application/json application/javascript application/x-javascript text/xml application/xml application/xml+rss text/javascript;

    # location / {
    #   try_files $uri $uri/ /index.html;
    # }


    location /alfresco/ {
      proxy_pass         http://${acs.host}:8080/alfresco/;
      proxy_redirect     default;

      include cors_support.conf;
      include proxy_pass.conf;
    }

    location = /share {
      rewrite ^ /share/ permanent;
    }

    location /share/ {
      proxy_pass         http://${share.host}:8080/share/;
      proxy_redirect     default;

      include cors_support.conf;
      include proxy_pass.conf;
    }


    location / {
        root   /usr/share/nginx/html;
        index  index.html index.htm;
    }

    # location ~ \.html$ {
    #   add_header Cache-Control "private, no-cache, no-store, must-revalidate";
    #   add_header Expires "Sat, 01 Jan 2000 00:00:00 GMT";
    #   add_header Pragma no-cache;
    # }
  }
}
